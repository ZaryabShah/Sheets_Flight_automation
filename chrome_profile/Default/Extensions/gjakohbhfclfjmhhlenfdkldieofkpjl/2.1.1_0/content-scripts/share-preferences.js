var sharePreferences=function(){"use strict";function Ve(r){return r}var Y=Object.prototype.hasOwnProperty;function L(r,e){var t,n;if(r===e)return!0;if(r&&e&&(t=r.constructor)===e.constructor){if(t===Date)return r.getTime()===e.getTime();if(t===RegExp)return r.toString()===e.toString();if(t===Array){if((n=r.length)===e.length)for(;n--&&L(r[n],e[n]););return n===-1}if(!t||typeof r=="object"){n=0;for(t in r)if(Y.call(r,t)&&++n&&!Y.call(e,t)||!(t in e)||!L(r[t],e[t]))return!1;return Object.keys(e).length===n}}return r!==r&&e!==e}const se=new Error("request for lock canceled");var ie=function(r,e,t,n){function l(c){return c instanceof t?c:new t(function(d){d(c)})}return new(t||(t=Promise))(function(c,d){function p(m){try{w(n.next(m))}catch(I){d(I)}}function f(m){try{w(n.throw(m))}catch(I){d(I)}}function w(m){m.done?c(m.value):l(m.value).then(p,f)}w((n=n.apply(r,e||[])).next())})};class ae{constructor(e,t=se){this._value=e,this._cancelError=t,this._queue=[],this._weightedWaiters=[]}acquire(e=1,t=0){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise((n,l)=>{const c={resolve:n,reject:l,weight:e,priority:t},d=Q(this._queue,p=>t<=p.priority);d===-1&&e<=this._value?this._dispatchItem(c):this._queue.splice(d+1,0,c)})}runExclusive(e){return ie(this,arguments,void 0,function*(t,n=1,l=0){const[c,d]=yield this.acquire(n,l);try{return yield t(c)}finally{d()}})}waitForUnlock(e=1,t=0){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return this._couldLockImmediately(e,t)?Promise.resolve():new Promise(n=>{this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),oe(this._weightedWaiters[e-1],{resolve:n,priority:t})})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatchQueue()}release(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatchQueue()}cancel(){this._queue.forEach(e=>e.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(e){const t=this._value;this._value-=e.weight,e.resolve([t,this._newReleaser(e.weight)])}_newReleaser(e){let t=!1;return()=>{t||(t=!0,this.release(e))}}_drainUnlockWaiters(){if(this._queue.length===0)for(let e=this._value;e>0;e--){const t=this._weightedWaiters[e-1];t&&(t.forEach(n=>n.resolve()),this._weightedWaiters[e-1]=[])}else{const e=this._queue[0].priority;for(let t=this._value;t>0;t--){const n=this._weightedWaiters[t-1];if(!n)continue;const l=n.findIndex(c=>c.priority<=e);(l===-1?n:n.splice(0,l)).forEach(c=>c.resolve())}}}_couldLockImmediately(e,t){return(this._queue.length===0||this._queue[0].priority<t)&&e<=this._value}}function oe(r,e){const t=Q(r,n=>e.priority<=n.priority);r.splice(t+1,0,e)}function Q(r,e){for(let t=r.length-1;t>=0;t--)if(e(r[t]))return t;return-1}var ce=function(r,e,t,n){function l(c){return c instanceof t?c:new t(function(d){d(c)})}return new(t||(t=Promise))(function(c,d){function p(m){try{w(n.next(m))}catch(I){d(I)}}function f(m){try{w(n.throw(m))}catch(I){d(I)}}function w(m){m.done?c(m.value):l(m.value).then(p,f)}w((n=n.apply(r,e||[])).next())})};class le{constructor(e){this._semaphore=new ae(1,e)}acquire(){return ce(this,arguments,void 0,function*(e=0){const[,t]=yield this._semaphore.acquire(1,e);return t})}runExclusive(e,t=0){return this._semaphore.runExclusive(()=>e(),1,t)}isLocked(){return this._semaphore.isLocked()}waitForUnlock(e=0){return this._semaphore.waitForUnlock(1,e)}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}const V=globalThis.browser?.runtime?.id==null?globalThis.chrome:globalThis.browser,T=ue();function ue(){const r={local:K("local"),session:K("session"),sync:K("sync"),managed:K("managed")},e=i=>{const a=r[i];if(a==null){const s=Object.keys(r).join(", ");throw Error(`Invalid area "${i}". Options: ${s}`)}return a},t=i=>{const a=i.indexOf(":"),s=i.substring(0,a),o=i.substring(a+1);if(o==null)throw Error(`Storage key should be in the form of "area:key", but received "${i}"`);return{driverArea:s,driverKey:o,driver:e(s)}},n=i=>i+"$",l=(i,a)=>{const s={...i};return Object.entries(a).forEach(([o,u])=>{u==null?delete s[o]:s[o]=u}),s},c=(i,a)=>i??a??null,d=i=>typeof i=="object"&&!Array.isArray(i)?i:{},p=async(i,a,s)=>{const o=await i.getItem(a);return c(o,s?.fallback??s?.defaultValue)},f=async(i,a)=>{const s=n(a),o=await i.getItem(s);return d(o)},w=async(i,a,s)=>{await i.setItem(a,s??null)},m=async(i,a,s)=>{const o=n(a),u=d(await i.getItem(o));await i.setItem(o,l(u,s))},I=async(i,a,s)=>{if(await i.removeItem(a),s?.removeMeta){const o=n(a);await i.removeItem(o)}},re=async(i,a,s)=>{const o=n(a);if(s==null)await i.removeItem(o);else{const u=d(await i.getItem(o));[s].flat().forEach(h=>delete u[h]),await i.setItem(o,u)}},ne=(i,a,s)=>i.watch(a,s);return{getItem:async(i,a)=>{const{driver:s,driverKey:o}=t(i);return await p(s,o,a)},getItems:async i=>{const a=new Map,s=new Map,o=[];i.forEach(h=>{let y,v;typeof h=="string"?y=h:"getValue"in h?(y=h.key,v={fallback:h.fallback}):(y=h.key,v=h.options),o.push(y);const{driverArea:_,driverKey:b}=t(y),E=a.get(_)??[];a.set(_,E.concat(b)),s.set(y,v)});const u=new Map;return await Promise.all(Array.from(a.entries()).map(async([h,y])=>{(await r[h].getItems(y)).forEach(_=>{const b=`${h}:${_.key}`,E=s.get(b),g=c(_.value,E?.fallback??E?.defaultValue);u.set(b,g)})})),o.map(h=>({key:h,value:u.get(h)}))},getMeta:async i=>{const{driver:a,driverKey:s}=t(i);return await f(a,s)},getMetas:async i=>{const a=i.map(u=>{const h=typeof u=="string"?u:u.key,{driverArea:y,driverKey:v}=t(h);return{key:h,driverArea:y,driverKey:v,driverMetaKey:n(v)}}),s=a.reduce((u,h)=>(u[h.driverArea]??=[],u[h.driverArea].push(h),u),{}),o={};return await Promise.all(Object.entries(s).map(async([u,h])=>{const y=await V.storage[u].get(h.map(v=>v.driverMetaKey));h.forEach(v=>{o[v.key]=y[v.driverMetaKey]??{}})})),a.map(u=>({key:u.key,meta:o[u.key]}))},setItem:async(i,a)=>{const{driver:s,driverKey:o}=t(i);await w(s,o,a)},setItems:async i=>{const a={};i.forEach(s=>{const{driverArea:o,driverKey:u}=t("key"in s?s.key:s.item.key);a[o]??=[],a[o].push({key:u,value:s.value})}),await Promise.all(Object.entries(a).map(async([s,o])=>{await e(s).setItems(o)}))},setMeta:async(i,a)=>{const{driver:s,driverKey:o}=t(i);await m(s,o,a)},setMetas:async i=>{const a={};i.forEach(s=>{const{driverArea:o,driverKey:u}=t("key"in s?s.key:s.item.key);a[o]??=[],a[o].push({key:u,properties:s.meta})}),await Promise.all(Object.entries(a).map(async([s,o])=>{const u=e(s),h=o.map(({key:b})=>n(b));console.log(s,h);const y=await u.getItems(h),v=Object.fromEntries(y.map(({key:b,value:E})=>[b,d(E)])),_=o.map(({key:b,properties:E})=>{const g=n(b);return{key:g,value:l(v[g]??{},E)}});await u.setItems(_)}))},removeItem:async(i,a)=>{const{driver:s,driverKey:o}=t(i);await I(s,o,a)},removeItems:async i=>{const a={};i.forEach(s=>{let o,u;typeof s=="string"?o=s:"getValue"in s?o=s.key:"item"in s?(o=s.item.key,u=s.options):(o=s.key,u=s.options);const{driverArea:h,driverKey:y}=t(o);a[h]??=[],a[h].push(y),u?.removeMeta&&a[h].push(n(y))}),await Promise.all(Object.entries(a).map(async([s,o])=>{await e(s).removeItems(o)}))},clear:async i=>{await e(i).clear()},removeMeta:async(i,a)=>{const{driver:s,driverKey:o}=t(i);await re(s,o,a)},snapshot:async(i,a)=>{const o=await e(i).snapshot();return a?.excludeKeys?.forEach(u=>{delete o[u],delete o[n(u)]}),o},restoreSnapshot:async(i,a)=>{await e(i).restoreSnapshot(a)},watch:(i,a)=>{const{driver:s,driverKey:o}=t(i);return ne(s,o,a)},unwatch(){Object.values(r).forEach(i=>{i.unwatch()})},defineItem:(i,a)=>{const{driver:s,driverKey:o}=t(i),{version:u=1,migrations:h={}}=a??{};if(u<1)throw Error("Storage item version cannot be less than 1. Initial versions should be set to 1, not 0.");const y=async()=>{const g=n(o),[{value:x},{value:C}]=await s.getItems([o,g]);if(x==null)return;const k=C?.v??1;if(k>u)throw Error(`Version downgrade detected (v${k} -> v${u}) for "${i}"`);if(k===u)return;console.debug(`[@wxt-dev/storage] Running storage migration for ${i}: v${k} -> v${u}`);const Pe=Array.from({length:u-k},(W,G)=>k+G+1);let P=x;for(const W of Pe)try{P=await h?.[W]?.(P)??P}catch(G){throw new de(i,W,{cause:G})}await s.setItems([{key:o,value:P},{key:g,value:{...C,v:u}}]),console.debug(`[@wxt-dev/storage] Storage migration completed for ${i} v${u}`,{migratedValue:P})},v=a?.migrations==null?Promise.resolve():y().catch(g=>{console.error(`[@wxt-dev/storage] Migration failed for ${i}`,g)}),_=new le,b=()=>a?.fallback??a?.defaultValue??null,E=()=>_.runExclusive(async()=>{const g=await s.getItem(o);if(g!=null||a?.init==null)return g;const x=await a.init();return await s.setItem(o,x),x});return v.then(E),{key:i,get defaultValue(){return b()},get fallback(){return b()},getValue:async()=>(await v,a?.init?await E():await p(s,o,a)),getMeta:async()=>(await v,await f(s,o)),setValue:async g=>(await v,await w(s,o,g)),setMeta:async g=>(await v,await m(s,o,g)),removeValue:async g=>(await v,await I(s,o,g)),removeMeta:async g=>(await v,await re(s,o,g)),watch:g=>ne(s,o,(x,C)=>g(x??b(),C??b())),migrate:y}}}}function K(r){const e=()=>{if(V.runtime==null)throw Error(["'wxt/storage' must be loaded in a web extension environment",`
 - If thrown during a build, see https://github.com/wxt-dev/wxt/issues/371`,` - If thrown during tests, mock 'wxt/browser' correctly. See https://wxt.dev/guide/go-further/testing.html
`].join(`
`));if(V.storage==null)throw Error("You must add the 'storage' permission to your manifest to use 'wxt/storage'");const n=V.storage[r];if(n==null)throw Error(`"browser.storage.${r}" is undefined`);return n},t=new Set;return{getItem:async n=>(await e().get(n))[n],getItems:async n=>{const l=await e().get(n);return n.map(c=>({key:c,value:l[c]??null}))},setItem:async(n,l)=>{l==null?await e().remove(n):await e().set({[n]:l})},setItems:async n=>{const l=n.reduce((c,{key:d,value:p})=>(c[d]=p,c),{});await e().set(l)},removeItem:async n=>{await e().remove(n)},removeItems:async n=>{await e().remove(n)},clear:async()=>{await e().clear()},snapshot:async()=>await e().get(),restoreSnapshot:async n=>{await e().set(n)},watch(n,l){const c=d=>{const p=d[n];p!=null&&(L(p.newValue,p.oldValue)||l(p.newValue??null,p.oldValue??null))};return e().onChanged.addListener(c),t.add(c),()=>{e().onChanged.removeListener(c),t.delete(c)}},unwatch(){t.forEach(n=>{e().onChanged.removeListener(n)}),t.clear()}}}class de extends Error{constructor(e,t,n){super(`v${t} migration failed for "${e}"`,n),this.key=e,this.version=t}}const A=globalThis.browser?.runtime?.id?globalThis.browser:globalThis.chrome,he="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let fe=(r=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(r|=0));for(;r--;)e+=he[t[r]&63];return e};var O;function B(r){return{lang:r?.lang??O?.lang,message:r?.message,abortEarly:r?.abortEarly??O?.abortEarly,abortPipeEarly:r?.abortPipeEarly??O?.abortPipeEarly}}var me;function pe(r){return me?.get(r)}var ve;function ge(r){return ve?.get(r)}var ye;function we(r,e){return ye?.get(r)?.get(e)}function H(r){const e=typeof r;return e==="string"?`"${r}"`:e==="number"||e==="bigint"||e==="boolean"?`${r}`:e==="object"||e==="function"?(r&&Object.getPrototypeOf(r)?.constructor?.name)??"null":e}function S(r,e,t,n,l){const c=l&&"input"in l?l.input:t.value,d=l?.expected??r.expects??null,p=l?.received??H(c),f={kind:r.kind,type:r.type,input:c,expected:d,received:p,message:`Invalid ${e}: ${d?`Expected ${d} but r`:"R"}eceived ${p}`,requirement:r.requirement,path:l?.path,issues:l?.issues,lang:n.lang,abortEarly:n.abortEarly,abortPipeEarly:n.abortPipeEarly},w=r.kind==="schema",m=l?.message??r.message??we(r.reference,f.lang)??(w?ge(f.lang):null)??n.message??pe(f.lang);m!==void 0&&(f.message=typeof m=="function"?m(f):m),w&&(t.typed=!1),t.issues?t.issues.push(f):t.issues=[f]}function $(r){return{version:1,vendor:"valibot",validate(e){return r["~run"]({value:e},B())}}}function be(r,e){const t=[...new Set(r)];return t.length>1?`(${t.join(` ${e} `)})`:t[0]??"never"}function J(r){return{kind:"transformation",type:"transform",reference:J,async:!1,operation:r,"~run"(e){return e.value=this.operation(e.value),e}}}function Ee(r,e,t){return typeof r.fallback=="function"?r.fallback(e,t):r.fallback}function Ie(r,e,t){return typeof r.default=="function"?r.default(e,t):r.default}function N(r,e){return{kind:"schema",type:"literal",reference:N,expects:H(r),async:!1,literal:r,message:e,get"~standard"(){return $(this)},"~run"(t,n){return t.value===this.literal?t.typed=!0:S(this,"type",t,n),t}}}function R(r,e){return{kind:"schema",type:"object",reference:R,expects:"Object",async:!1,entries:r,message:e,get"~standard"(){return $(this)},"~run"(t,n){const l=t.value;if(l&&typeof l=="object"){t.typed=!0,t.value={};for(const c in this.entries){const d=this.entries[c];if(c in l||(d.type==="exact_optional"||d.type==="optional"||d.type==="nullish")&&d.default!==void 0){const p=c in l?l[c]:Ie(d),f=d["~run"]({value:p},n);if(f.issues){const w={type:"object",origin:"value",input:l,key:c,value:p};for(const m of f.issues)m.path?m.path.unshift(w):m.path=[w],t.issues?.push(m);if(t.issues||(t.issues=f.issues),n.abortEarly){t.typed=!1;break}}f.typed||(t.typed=!1),t.value[c]=f.value}else if(d.fallback!==void 0)t.value[c]=Ee(d);else if(d.type!=="exact_optional"&&d.type!=="optional"&&d.type!=="nullish"&&(S(this,"key",t,n,{input:void 0,expected:`"${c}"`,path:[{type:"object",origin:"key",input:l,key:c,value:l[c]}]}),n.abortEarly))break}}else S(this,"type",t,n);return t}}}function M(r){return{kind:"schema",type:"string",reference:M,expects:"string",async:!1,message:r,get"~standard"(){return $(this)},"~run"(e,t){return typeof e.value=="string"?e.typed=!0:S(this,"type",e,t),e}}}function X(r){let e;if(r)for(const t of r)e?e.push(...t.issues):e=t.issues;return e}function Z(r,e){return{kind:"schema",type:"union",reference:Z,expects:be(r.map(t=>t.expects),"|"),async:!1,options:r,message:e,get"~standard"(){return $(this)},"~run"(t,n){let l,c,d;for(const p of this.options){const f=p["~run"]({value:t.value},n);if(f.typed)if(f.issues)c?c.push(f):c=[f];else{l=f;break}else d?d.push(f):d=[f]}if(l)return l;if(c){if(c.length===1)return c[0];S(this,"type",t,n,{issues:X(c)}),t.typed=!0}else{if(d?.length===1)return d[0];S(this,"type",t,n,{issues:X(d)})}return t}}}function _e(...r){return{...r[0],pipe:r,get"~standard"(){return $(this)},"~run"(e,t){for(const n of r)if(n.kind!=="metadata"){if(e.issues&&(n.kind==="schema"||n.kind==="transformation")){e.typed=!1;break}(!e.issues||!t.abortEarly&&!t.abortPipeEarly)&&(e=n["~run"](e,t))}return e}}}function xe(r,e,t){const n=r["~run"]({value:e},B(t));return{typed:n.typed,success:!n.issues,output:n.value,issues:n.issues}}T.defineItem("local:proxies",{init:async()=>{const{profiles:r}=await A.storage.local.get("profiles");if(!r||!Array.isArray(r))return[];const e=R({profile_name:M(),singleProxy:R({host:M(),password:M(),port:_e(M(),J(Number)),scheme:Z([N("http"),N("socks5")]),username:M()})}),t=r.map(n=>{const l=xe(e,n);if(!l.success)return null;const{output:c}=l;return{type:"manual",id:fe(),name:c.profile_name,proxy:{type:c.singleProxy.scheme,host:c.singleProxy.host,port:c.singleProxy.port,username:c.singleProxy.username,password:c.singleProxy.password,bypassList:[]}}}).filter(n=>n!==null);return await A.storage.local.remove("profiles"),t},version:1});const z=T.defineItem("local:selectedProxyId",{fallback:null,version:1});T.defineItem("session:connection",{fallback:{status:"disconnected",error:null},version:1});const ee=T.defineItem("local:webrtc-protection",{defaultValue:!0}),te="iproyal@@extension@@state",Se={main:()=>{let r;try{r=document.getElementById(te),r.remove()}catch{r=document.createElement("span"),r.id=te,document.documentElement.append(r)}const e=n=>{r.dataset.webrtcProtection=n.toString()};ee.watch(e),ee.getValue().then(e);const t=n=>{r.dataset.proxyConnected=n!==null?"true":"false"};z.watch(t),z.getValue().then(t)},runAt:"document_start",matches:["<all_urls>"],allFrames:!0};function q(r,...e){}const Me={debug:(...r)=>q(console.debug,...r),log:(...r)=>q(console.log,...r),warn:(...r)=>q(console.warn,...r),error:(...r)=>q(console.error,...r)};class D extends Event{constructor(e,t){super(D.EVENT_NAME,{}),this.newUrl=e,this.oldUrl=t}static EVENT_NAME=U("wxt:locationchange")}function U(r){return`${A?.runtime?.id}:share-preferences:${r}`}function ke(r){let e,t;return{run(){e==null&&(t=new URL(location.href),e=r.setInterval(()=>{let n=new URL(location.href);n.href!==t.href&&(window.dispatchEvent(new D(n,t)),t=n)},1e3))}}}class j{constructor(e,t){this.contentScriptName=e,this.options=t,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}static SCRIPT_STARTED_MESSAGE_TYPE=U("wxt:content-script-started");isTopFrame=window.self===window.top;abortController;locationWatcher=ke(this);receivedMessageIds=new Set;get signal(){return this.abortController.signal}abort(e){return this.abortController.abort(e)}get isInvalid(){return A.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(e){return this.signal.addEventListener("abort",e),()=>this.signal.removeEventListener("abort",e)}block(){return new Promise(()=>{})}setInterval(e,t){const n=setInterval(()=>{this.isValid&&e()},t);return this.onInvalidated(()=>clearInterval(n)),n}setTimeout(e,t){const n=setTimeout(()=>{this.isValid&&e()},t);return this.onInvalidated(()=>clearTimeout(n)),n}requestAnimationFrame(e){const t=requestAnimationFrame((...n)=>{this.isValid&&e(...n)});return this.onInvalidated(()=>cancelAnimationFrame(t)),t}requestIdleCallback(e,t){const n=requestIdleCallback((...l)=>{this.signal.aborted||e(...l)},t);return this.onInvalidated(()=>cancelIdleCallback(n)),n}addEventListener(e,t,n,l){t==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),e.addEventListener?.(t.startsWith("wxt:")?U(t):t,n,{...l,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),Me.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:j.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(e){const t=e.data?.type===j.SCRIPT_STARTED_MESSAGE_TYPE,n=e.data?.contentScriptName===this.contentScriptName,l=!this.receivedMessageIds.has(e.data?.messageId);return t&&n&&l}listenForNewerScripts(e){let t=!0;const n=l=>{if(this.verifyScriptStartedEvent(l)){this.receivedMessageIds.add(l.data.messageId);const c=t;if(t=!1,c&&e?.ignoreFirstEvent)return;this.notifyInvalidated()}};addEventListener("message",n),this.onInvalidated(()=>removeEventListener("message",n))}}function Ke(){}function F(r,...e){}const $e={debug:(...r)=>F(console.debug,...r),log:(...r)=>F(console.log,...r),warn:(...r)=>F(console.warn,...r),error:(...r)=>F(console.error,...r)};return(async()=>{try{const{main:r,...e}=Se,t=new j("share-preferences",e);return await r(t)}catch(r){throw $e.error('The content script "share-preferences" crashed on startup!',r),r}})()}();
sharePreferences;
