const ee=globalThis.browser?.runtime?.id?globalThis.browser:globalThis.chrome,W=ee;var C=Object.prototype.hasOwnProperty;function q(n,e){var t,r;if(n===e)return!0;if(n&&e&&(t=n.constructor)===e.constructor){if(t===Date)return n.getTime()===e.getTime();if(t===RegExp)return n.toString()===e.toString();if(t===Array){if((r=n.length)===e.length)for(;r--&&q(n[r],e[r]););return r===-1}if(!t||typeof n=="object"){r=0;for(t in n)if(C.call(n,t)&&++r&&!C.call(e,t)||!(t in e)||!q(n[t],e[t]))return!1;return Object.keys(e).length===r}}return n!==n&&e!==e}const te=new Error("request for lock canceled");var ne=function(n,e,t,r){function l(c){return c instanceof t?c:new t(function(u){u(c)})}return new(t||(t=Promise))(function(c,u){function p(y){try{w(r.next(y))}catch(I){u(I)}}function d(y){try{w(r.throw(y))}catch(I){u(I)}}function w(y){y.done?c(y.value):l(y.value).then(p,d)}w((r=r.apply(n,e||[])).next())})};class re{constructor(e,t=te){this._value=e,this._cancelError=t,this._queue=[],this._weightedWaiters=[]}acquire(e=1,t=0){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise((r,l)=>{const c={resolve:r,reject:l,weight:e,priority:t},u=J(this._queue,p=>t<=p.priority);u===-1&&e<=this._value?this._dispatchItem(c):this._queue.splice(u+1,0,c)})}runExclusive(e){return ne(this,arguments,void 0,function*(t,r=1,l=0){const[c,u]=yield this.acquire(r,l);try{return yield t(c)}finally{u()}})}waitForUnlock(e=1,t=0){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return this._couldLockImmediately(e,t)?Promise.resolve():new Promise(r=>{this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),se(this._weightedWaiters[e-1],{resolve:r,priority:t})})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatchQueue()}release(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatchQueue()}cancel(){this._queue.forEach(e=>e.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(e){const t=this._value;this._value-=e.weight,e.resolve([t,this._newReleaser(e.weight)])}_newReleaser(e){let t=!1;return()=>{t||(t=!0,this.release(e))}}_drainUnlockWaiters(){if(this._queue.length===0)for(let e=this._value;e>0;e--){const t=this._weightedWaiters[e-1];t&&(t.forEach(r=>r.resolve()),this._weightedWaiters[e-1]=[])}else{const e=this._queue[0].priority;for(let t=this._value;t>0;t--){const r=this._weightedWaiters[t-1];if(!r)continue;const l=r.findIndex(c=>c.priority<=e);(l===-1?r:r.splice(0,l)).forEach(c=>c.resolve())}}}_couldLockImmediately(e,t){return(this._queue.length===0||this._queue[0].priority<t)&&e<=this._value}}function se(n,e){const t=J(n,r=>e.priority<=r.priority);n.splice(t+1,0,e)}function J(n,e){for(let t=n.length-1;t>=0;t--)if(e(n[t]))return t;return-1}var ie=function(n,e,t,r){function l(c){return c instanceof t?c:new t(function(u){u(c)})}return new(t||(t=Promise))(function(c,u){function p(y){try{w(r.next(y))}catch(I){u(I)}}function d(y){try{w(r.throw(y))}catch(I){u(I)}}function w(y){y.done?c(y.value):l(y.value).then(p,d)}w((r=r.apply(n,e||[])).next())})};class ae{constructor(e){this._semaphore=new re(1,e)}acquire(){return ie(this,arguments,void 0,function*(e=0){const[,t]=yield this._semaphore.acquire(1,e);return t})}runExclusive(e,t=0){return this._semaphore.runExclusive(()=>e(),1,t)}isLocked(){return this._semaphore.isLocked()}waitForUnlock(e=0){return this._semaphore.waitForUnlock(1,e)}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}const T=globalThis.browser?.runtime?.id==null?globalThis.chrome:globalThis.browser,M=oe();function oe(){const n={local:L("local"),session:L("session"),sync:L("sync"),managed:L("managed")},e=i=>{const a=n[i];if(a==null){const s=Object.keys(n).join(", ");throw Error(`Invalid area "${i}". Options: ${s}`)}return a},t=i=>{const a=i.indexOf(":"),s=i.substring(0,a),o=i.substring(a+1);if(o==null)throw Error(`Storage key should be in the form of "area:key", but received "${i}"`);return{driverArea:s,driverKey:o,driver:e(s)}},r=i=>i+"$",l=(i,a)=>{const s={...i};return Object.entries(a).forEach(([o,f])=>{f==null?delete s[o]:s[o]=f}),s},c=(i,a)=>i??a??null,u=i=>typeof i=="object"&&!Array.isArray(i)?i:{},p=async(i,a,s)=>{const o=await i.getItem(a);return c(o,s?.fallback??s?.defaultValue)},d=async(i,a)=>{const s=r(a),o=await i.getItem(s);return u(o)},w=async(i,a,s)=>{await i.setItem(a,s??null)},y=async(i,a,s)=>{const o=r(a),f=u(await i.getItem(o));await i.setItem(o,l(f,s))},I=async(i,a,s)=>{if(await i.removeItem(a),s?.removeMeta){const o=r(a);await i.removeItem(o)}},U=async(i,a,s)=>{const o=r(a);if(s==null)await i.removeItem(o);else{const f=u(await i.getItem(o));[s].flat().forEach(h=>delete f[h]),await i.setItem(o,f)}},F=(i,a,s)=>i.watch(a,s);return{getItem:async(i,a)=>{const{driver:s,driverKey:o}=t(i);return await p(s,o,a)},getItems:async i=>{const a=new Map,s=new Map,o=[];i.forEach(h=>{let v,m;typeof h=="string"?v=h:"getValue"in h?(v=h.key,m={fallback:h.fallback}):(v=h.key,m=h.options),o.push(v);const{driverArea:k,driverKey:b}=t(v),_=a.get(k)??[];a.set(k,_.concat(b)),s.set(v,m)});const f=new Map;return await Promise.all(Array.from(a.entries()).map(async([h,v])=>{(await n[h].getItems(v)).forEach(k=>{const b=`${h}:${k.key}`,_=s.get(b),g=c(k.value,_?.fallback??_?.defaultValue);f.set(b,g)})})),o.map(h=>({key:h,value:f.get(h)}))},getMeta:async i=>{const{driver:a,driverKey:s}=t(i);return await d(a,s)},getMetas:async i=>{const a=i.map(f=>{const h=typeof f=="string"?f:f.key,{driverArea:v,driverKey:m}=t(h);return{key:h,driverArea:v,driverKey:m,driverMetaKey:r(m)}}),s=a.reduce((f,h)=>(f[h.driverArea]??=[],f[h.driverArea].push(h),f),{}),o={};return await Promise.all(Object.entries(s).map(async([f,h])=>{const v=await T.storage[f].get(h.map(m=>m.driverMetaKey));h.forEach(m=>{o[m.key]=v[m.driverMetaKey]??{}})})),a.map(f=>({key:f.key,meta:o[f.key]}))},setItem:async(i,a)=>{const{driver:s,driverKey:o}=t(i);await w(s,o,a)},setItems:async i=>{const a={};i.forEach(s=>{const{driverArea:o,driverKey:f}=t("key"in s?s.key:s.item.key);a[o]??=[],a[o].push({key:f,value:s.value})}),await Promise.all(Object.entries(a).map(async([s,o])=>{await e(s).setItems(o)}))},setMeta:async(i,a)=>{const{driver:s,driverKey:o}=t(i);await y(s,o,a)},setMetas:async i=>{const a={};i.forEach(s=>{const{driverArea:o,driverKey:f}=t("key"in s?s.key:s.item.key);a[o]??=[],a[o].push({key:f,properties:s.meta})}),await Promise.all(Object.entries(a).map(async([s,o])=>{const f=e(s),h=o.map(({key:b})=>r(b));console.log(s,h);const v=await f.getItems(h),m=Object.fromEntries(v.map(({key:b,value:_})=>[b,u(_)])),k=o.map(({key:b,properties:_})=>{const g=r(b);return{key:g,value:l(m[g]??{},_)}});await f.setItems(k)}))},removeItem:async(i,a)=>{const{driver:s,driverKey:o}=t(i);await I(s,o,a)},removeItems:async i=>{const a={};i.forEach(s=>{let o,f;typeof s=="string"?o=s:"getValue"in s?o=s.key:"item"in s?(o=s.item.key,f=s.options):(o=s.key,f=s.options);const{driverArea:h,driverKey:v}=t(o);a[h]??=[],a[h].push(v),f?.removeMeta&&a[h].push(r(v))}),await Promise.all(Object.entries(a).map(async([s,o])=>{await e(s).removeItems(o)}))},clear:async i=>{await e(i).clear()},removeMeta:async(i,a)=>{const{driver:s,driverKey:o}=t(i);await U(s,o,a)},snapshot:async(i,a)=>{const o=await e(i).snapshot();return a?.excludeKeys?.forEach(f=>{delete o[f],delete o[r(f)]}),o},restoreSnapshot:async(i,a)=>{await e(i).restoreSnapshot(a)},watch:(i,a)=>{const{driver:s,driverKey:o}=t(i);return F(s,o,a)},unwatch(){Object.values(n).forEach(i=>{i.unwatch()})},defineItem:(i,a)=>{const{driver:s,driverKey:o}=t(i),{version:f=1,migrations:h={}}=a??{};if(f<1)throw Error("Storage item version cannot be less than 1. Initial versions should be set to 1, not 0.");const v=async()=>{const g=r(o),[{value:E},{value:j}]=await s.getItems([o,g]);if(E==null)return;const V=j?.v??1;if(V>f)throw Error(`Version downgrade detected (v${V} -> v${f}) for "${i}"`);if(V===f)return;console.debug(`[@wxt-dev/storage] Running storage migration for ${i}: v${V} -> v${f}`);const Z=Array.from({length:f-V},(O,N)=>V+N+1);let P=E;for(const O of Z)try{P=await h?.[O]?.(P)??P}catch(N){throw new ce(i,O,{cause:N})}await s.setItems([{key:o,value:P},{key:g,value:{...j,v:f}}]),console.debug(`[@wxt-dev/storage] Storage migration completed for ${i} v${f}`,{migratedValue:P})},m=a?.migrations==null?Promise.resolve():v().catch(g=>{console.error(`[@wxt-dev/storage] Migration failed for ${i}`,g)}),k=new ae,b=()=>a?.fallback??a?.defaultValue??null,_=()=>k.runExclusive(async()=>{const g=await s.getItem(o);if(g!=null||a?.init==null)return g;const E=await a.init();return await s.setItem(o,E),E});return m.then(_),{key:i,get defaultValue(){return b()},get fallback(){return b()},getValue:async()=>(await m,a?.init?await _():await p(s,o,a)),getMeta:async()=>(await m,await d(s,o)),setValue:async g=>(await m,await w(s,o,g)),setMeta:async g=>(await m,await y(s,o,g)),removeValue:async g=>(await m,await I(s,o,g)),removeMeta:async g=>(await m,await U(s,o,g)),watch:g=>F(s,o,(E,j)=>g(E??b(),j??b())),migrate:v}}}}function L(n){const e=()=>{if(T.runtime==null)throw Error(["'wxt/storage' must be loaded in a web extension environment",`
 - If thrown during a build, see https://github.com/wxt-dev/wxt/issues/371`,` - If thrown during tests, mock 'wxt/browser' correctly. See https://wxt.dev/guide/go-further/testing.html
`].join(`
`));if(T.storage==null)throw Error("You must add the 'storage' permission to your manifest to use 'wxt/storage'");const r=T.storage[n];if(r==null)throw Error(`"browser.storage.${n}" is undefined`);return r},t=new Set;return{getItem:async r=>(await e().get(r))[r],getItems:async r=>{const l=await e().get(r);return r.map(c=>({key:c,value:l[c]??null}))},setItem:async(r,l)=>{l==null?await e().remove(r):await e().set({[r]:l})},setItems:async r=>{const l=r.reduce((c,{key:u,value:p})=>(c[u]=p,c),{});await e().set(l)},removeItem:async r=>{await e().remove(r)},removeItems:async r=>{await e().remove(r)},clear:async()=>{await e().clear()},snapshot:async()=>await e().get(),restoreSnapshot:async r=>{await e().set(r)},watch(r,l){const c=u=>{const p=u[r];p!=null&&(q(p.newValue,p.oldValue)||l(p.newValue??null,p.oldValue??null))};return e().onChanged.addListener(c),t.add(c),()=>{e().onChanged.removeListener(c),t.delete(c)}},unwatch(){t.forEach(r=>{e().onChanged.removeListener(r)}),t.clear()}}}class ce extends Error{constructor(e,t,r){super(`v${t} migration failed for "${e}"`,r),this.key=e,this.version=t}}const le=async n=>{const e=new TextEncoder,t=await crypto.subtle.digest("SHA-1",e.encode(n));return[...new Uint8Array(t)].map(r=>r.toString(16).padStart(2,"0")).join("")},ue="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let fe=n=>crypto.getRandomValues(new Uint8Array(n)),he=(n,e,t)=>{let r=(2<<Math.log2(n.length-1))-1,l=-~(1.6*r*e/n.length);return(c=e)=>{let u="";for(;;){let p=t(l),d=l|0;for(;d--;)if(u+=n[p[d]&r]||"",u.length>=c)return u}}},We=(n,e=21)=>he(n,e|0,fe),z=(n=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(n|=0));for(;n--;)e+=ue[t[n]&63];return e};const de=M.defineItem("local:client-id",{init:()=>z()}),B=M.defineItem("session:analytics-user-id"),Ce=async n=>{const e=typeof n=="number"?await le(n.toString()):void 0;await B.setValue(e)},Ge=async(n,e)=>{const t="G-S5S01SJGJB",r="jmo8_mOVRxuF935RG7NNWw",l=!!r;if(console.info("[GA]",n,e,l),!l)return;const[c,u]=await Promise.all([de.getValue(),B.getValue()]);await fetch(`https://www.google-analytics.com/mp/collect?measurement_id=${t}&api_secret=${r}`,{method:"POST",body:JSON.stringify({client_id:c,user_id:u,events:[{name:n,params:e}]})})};var A;function Q(n){return{lang:n?.lang??A?.lang,message:n?.message,abortEarly:n?.abortEarly??A?.abortEarly,abortPipeEarly:n?.abortPipeEarly??A?.abortPipeEarly}}var ye;function pe(n){return ye?.get(n)}var me;function ge(n){return me?.get(n)}var ve;function we(n,e){return ve?.get(n)?.get(e)}function K(n){const e=typeof n;return e==="string"?`"${n}"`:e==="number"||e==="bigint"||e==="boolean"?`${n}`:e==="object"||e==="function"?(n&&Object.getPrototypeOf(n)?.constructor?.name)??"null":e}function x(n,e,t,r,l){const c=l&&"input"in l?l.input:t.value,u=l?.expected??n.expects??null,p=l?.received??K(c),d={kind:n.kind,type:n.type,input:c,expected:u,received:p,message:`Invalid ${e}: ${u?`Expected ${u} but r`:"R"}eceived ${p}`,requirement:n.requirement,path:l?.path,issues:l?.issues,lang:r.lang,abortEarly:r.abortEarly,abortPipeEarly:r.abortPipeEarly},w=n.kind==="schema",y=l?.message??n.message??we(n.reference,d.lang)??(w?ge(d.lang):null)??r.message??pe(d.lang);y!==void 0&&(d.message=typeof y=="function"?y(d):y),w&&(t.typed=!1),t.issues?t.issues.push(d):t.issues=[d]}function $(n){return{version:1,vendor:"valibot",validate(e){return n["~run"]({value:e},Q())}}}function be(n,e){const t=[...new Set(n)];return t.length>1?`(${t.join(` ${e} `)})`:t[0]??"never"}var xe=/^[\w+-]+(?:\.[\w+-]+)*@[\da-z]+(?:[.-][\da-z]+)*\.[a-z]{2,}$/iu;function _e(n){return{kind:"validation",type:"email",reference:_e,expects:null,async:!1,requirement:xe,message:n,"~run"(e,t){return e.typed&&!this.requirement.test(e.value)&&x(this,"email",e,t),e}}}function Ie(n,e){return{kind:"validation",type:"max_length",reference:Ie,async:!1,expects:`<=${n}`,requirement:n,message:e,"~run"(t,r){return t.typed&&t.value.length>this.requirement&&x(this,"length",t,r,{received:`${t.value.length}`}),t}}}function ke(n,e){return{kind:"validation",type:"max_value",reference:ke,async:!1,expects:`<=${n instanceof Date?n.toJSON():K(n)}`,requirement:n,message:e,"~run"(t,r){return t.typed&&!(t.value<=this.requirement)&&x(this,"value",t,r,{received:t.value instanceof Date?t.value.toJSON():K(t.value)}),t}}}function Ee(n,e){return{kind:"validation",type:"min_length",reference:Ee,async:!1,expects:`>=${n}`,requirement:n,message:e,"~run"(t,r){return t.typed&&t.value.length<this.requirement&&x(this,"length",t,r,{received:`${t.value.length}`}),t}}}function Me(n,e){return{kind:"validation",type:"min_value",reference:Me,async:!1,expects:`>=${n instanceof Date?n.toJSON():K(n)}`,requirement:n,message:e,"~run"(t,r){return t.typed&&!(t.value>=this.requirement)&&x(this,"value",t,r,{received:t.value instanceof Date?t.value.toJSON():K(t.value)}),t}}}function $e(n){return{kind:"validation",type:"non_empty",reference:$e,async:!1,expects:"!0",message:n,"~run"(e,t){return e.typed&&e.value.length===0&&x(this,"length",e,t,{received:"0"}),e}}}function Y(n){return{kind:"transformation",type:"transform",reference:Y,async:!1,operation:n,"~run"(e){return e.value=this.operation(e.value),e}}}function Je(n,e){return{...n,get"~standard"(){return $(this)},"~run"(t,r){return n["~run"](t,{...r,...e})}}}function Ve(n,e,t){return typeof n.fallback=="function"?n.fallback(e,t):n.fallback}function Se(n,e,t){return typeof n.default=="function"?n.default(e,t):n.default}function D(n,e){return{kind:"schema",type:"literal",reference:D,expects:K(n),async:!1,literal:n,message:e,get"~standard"(){return $(this)},"~run"(t,r){return t.value===this.literal?t.typed=!0:x(this,"type",t,r),t}}}function Ke(n){return{kind:"schema",type:"number",reference:Ke,expects:"number",async:!1,message:n,get"~standard"(){return $(this)},"~run"(e,t){return typeof e.value=="number"&&!isNaN(e.value)?e.typed=!0:x(this,"type",e,t),e}}}function R(n,e){return{kind:"schema",type:"object",reference:R,expects:"Object",async:!1,entries:n,message:e,get"~standard"(){return $(this)},"~run"(t,r){const l=t.value;if(l&&typeof l=="object"){t.typed=!0,t.value={};for(const c in this.entries){const u=this.entries[c];if(c in l||(u.type==="exact_optional"||u.type==="optional"||u.type==="nullish")&&u.default!==void 0){const p=c in l?l[c]:Se(u),d=u["~run"]({value:p},r);if(d.issues){const w={type:"object",origin:"value",input:l,key:c,value:p};for(const y of d.issues)y.path?y.path.unshift(w):y.path=[w],t.issues?.push(y);if(t.issues||(t.issues=d.issues),r.abortEarly){t.typed=!1;break}}d.typed||(t.typed=!1),t.value[c]=d.value}else if(u.fallback!==void 0)t.value[c]=Ve(u);else if(u.type!=="exact_optional"&&u.type!=="optional"&&u.type!=="nullish"&&(x(this,"key",t,r,{input:void 0,expected:`"${c}"`,path:[{type:"object",origin:"key",input:l,key:c,value:l[c]}]}),r.abortEarly))break}}else x(this,"type",t,r);return t}}}function S(n){return{kind:"schema",type:"string",reference:S,expects:"string",async:!1,message:n,get"~standard"(){return $(this)},"~run"(e,t){return typeof e.value=="string"?e.typed=!0:x(this,"type",e,t),e}}}function G(n){let e;if(n)for(const t of n)e?e.push(...t.issues):e=t.issues;return e}function H(n,e){return{kind:"schema",type:"union",reference:H,expects:be(n.map(t=>t.expects),"|"),async:!1,options:n,message:e,get"~standard"(){return $(this)},"~run"(t,r){let l,c,u;for(const p of this.options){const d=p["~run"]({value:t.value},r);if(d.typed)if(d.issues)c?c.push(d):c=[d];else{l=d;break}else u?u.push(d):u=[d]}if(l)return l;if(c){if(c.length===1)return c[0];x(this,"type",t,r,{issues:G(c)}),t.typed=!0}else{if(u?.length===1)return u[0];x(this,"type",t,r,{issues:G(u)})}return t}}}function Pe(...n){return{...n[0],pipe:n,get"~standard"(){return $(this)},"~run"(e,t){for(const r of n)if(r.kind!=="metadata"){if(e.issues&&(r.kind==="schema"||r.kind==="transformation")){e.typed=!1;break}(!e.issues||!t.abortEarly&&!t.abortPipeEarly)&&(e=r["~run"](e,t))}return e}}}function je(n,e,t){const r=n["~run"]({value:e},Q(t));return{typed:r.typed,success:!r.issues,output:r.value,issues:r.issues}}const Le=M.defineItem("local:proxies",{init:async()=>{const{profiles:n}=await W.storage.local.get("profiles");if(!n||!Array.isArray(n))return[];const e=R({profile_name:S(),singleProxy:R({host:S(),password:S(),port:Pe(S(),Y(Number)),scheme:H([D("http"),D("socks5")]),username:S()})}),t=n.map(r=>{const l=je(e,r);if(!l.success)return null;const{output:c}=l;return{type:"manual",id:z(),name:c.profile_name,proxy:{type:c.singleProxy.scheme,host:c.singleProxy.host,port:c.singleProxy.port,username:c.singleProxy.username,password:c.singleProxy.password,bypassList:[]}}}).filter(r=>r!==null);return await W.storage.local.remove("profiles"),t},version:1}),ze=M.defineItem("local:selectedProxyId",{fallback:null,version:1}),Be=async n=>(await Le.getValue()).find(t=>t.id===n)?.proxy??null,Qe=M.defineItem("session:connection",{fallback:{status:"disconnected",error:null},version:1}),Ye=M.defineItem("local:access-token",{fallback:null,version:1}),He=M.defineItem("local:webrtc-protection",{defaultValue:!0}),Te="en";let Oe=Te,X=()=>Oe;const Ne=n=>"Successfully logged in",Ae=n=>"已成功登录",qe=n=>"Đăng nhập thành công",Xe=(n={},e={})=>{const t=e.locale??e.languageTag??X();return t==="en"?Ne():t==="zh-CN"?Ae():t==="vi"?qe():"extensionNotificationLoginTitle"},De=n=>"You are ready to use your proxies from your account.",Re=n=>"您现在就可以使用您账号中的代理了。",Ue=n=>"Giờ đây bạn có thể sử dụng proxy từ tài khoản của mình.",Ze=(n={},e={})=>{const t=e.locale??e.languageTag??X();return t==="en"?De():t==="zh-CN"?Re():t==="vi"?Ue():"extensionNotificationLoginMessage"};function et(){}export{Ye as a,W as b,Qe as c,Xe as d,Ze as e,Be as f,Ce as g,X as h,et as i,We as j,Ee as k,$e as l,Ie as m,z as n,_e as o,Le as p,ke as q,Me as r,ze as s,Ge as t,je as u,Je as v,He as w,Ke as x,S as y,Pe as z};
